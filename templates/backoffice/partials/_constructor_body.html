<div id="constructor-messages" class="col-span-1 md:col-span-2 mb-4">
    {% if messages %}
        {% for message in messages %}
            <div class="p-3 rounded-lg text-sm font-medium mb-2
                {% if message.tags == 'success' %} bg-green-100 text-green-800 border border-green-200
                {% elif message.tags == 'warning' %} bg-yellow-100 text-yellow-800 border border-yellow-200
                {% elif message.tags == 'info' %} bg-blue-100 text-blue-800 border border-blue-200
                {% else %} bg-red-100 text-red-800 border border-red-200
                {% endif %}" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    
    <div class="bg-gray-800 rounded-lg shadow p-6 flex flex-col h-[600px]">
        <h2 class="text-xl font-semibold text-white mb-4 flex justify-between items-center">
            <span>En el Examen</span>
            <span class="bg-gray-700 text-xs px-2 py-1 rounded-full">{{ exam_items_count }}</span>
        </h2>
        
        <div class="flex-1 overflow-y-auto space-y-3 pr-2 custom-scrollbar">
            {% for item in exam_items %}
                <div class="p-3 bg-gray-700 rounded-lg flex items-start gap-3 group">
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium leading-tight mb-1">
                            {{ item.stem|truncatechars:60 }}
                        </p>
                        <span class="text-xs text-gray-400">
                            {{ item.get_item_type_display }}
                        </span>
                    </div>

                    <div class="flex flex-col gap-2">
                        <button hx-get="{% url 'backoffice:item_detail' item.id %}"
                                hx-target="#modal-content"
                                onclick="document.getElementById('item-detail-modal').classList.remove('hidden')"
                                class="text-gray-400 hover:text-blue-400" title="Ver detalle">
                            ğŸ‘ï¸
                        </button>
                        
                        <button hx-post="{% url 'backoffice:remove_item_from_exam' exam_id=exam.id item_id=item.id %}"
                                hx-target="#constructor-body"
                                hx-include="body [name='csrfmiddlewaretoken']"
                                class="text-gray-400 hover:text-red-400" title="Quitar del examen">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                </div>
            {% empty %}
                <div class="text-center py-10 text-gray-500 border-2 border-dashed border-gray-700 rounded-lg">
                    Tu examen estÃ¡ vacÃ­o.
                    <br>AÃ±ade preguntas desde el banco.
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="bg-gray-800 rounded-lg shadow p-6 flex flex-col h-[600px]">
        <h2 class="text-xl font-semibold text-white mb-4 flex justify-between items-center">
            <span>Banco de Preguntas</span>
            <span class="bg-gray-700 text-xs px-2 py-1 rounded-full">{{ bank_items_count }}</span>
        </h2>
        
        <div class="flex-1 overflow-y-auto space-y-3 pr-2 custom-scrollbar">
            {% for item in bank_items %}
                <div class="p-3 bg-gray-900 rounded-lg flex items-start gap-3 border-l-4
                            {% if item.source_tag == 'generated' %} border-green-500 {% elif item.source_tag == 'found' %} border-blue-500 {% else %} border-transparent {% endif %}">
                    
                    <div class="flex-1 min-w-0">
                        <div class="flex gap-1 mb-1">
                            {% if item.source_tag == 'generated' %}
                                <span class="text-[10px] bg-green-900 text-green-200 px-1.5 py-0.5 rounded border border-green-700">âœ¨ NUEVA</span>
                            {% endif %}
                            {% if item.source_tag == 'found' %}
                                <span class="text-[10px] bg-blue-900 text-blue-200 px-1.5 py-0.5 rounded border border-blue-700">ğŸ” ENCONTRADA</span>
                            {% endif %}
                        </div>

                        <p class="text-white text-sm font-medium leading-tight mb-1">
                            {{ item.stem|truncatechars:60 }}
                        </p>
                    </div>

                    <div class="flex flex-col gap-2">
                        <button hx-get="{% url 'backoffice:item_detail' item.id %}"
                                hx-target="#modal-content"
                                onclick="document.getElementById('item-detail-modal').classList.remove('hidden')"
                                class="text-gray-500 hover:text-blue-400" title="Ver detalle">
                            ğŸ‘ï¸
                        </button>

                        <button hx-post="{% url 'backoffice:add_item_to_exam' exam_id=exam.id item_id=item.id %}"
                                hx-target="#constructor-body"
                                hx-include="body [name='csrfmiddlewaretoken']"
                                class="text-blue-500 hover:text-blue-300 font-bold text-lg" title="AÃ±adir al examen">
                            +
                        </button>
                    </div>
                </div>
            {% empty %}
                <div class="text-center py-10 text-gray-500">
                    No hay preguntas disponibles.
                </div>
            {% endfor %}
        </div>
    </div>
</div>
