<form method="post" class="space-y-4">
    {% csrf_token %}
    
    <div class="grid grid-cols-2 gap-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Pregunta</label>
            <select name="item_type" 
                    class="w-full rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" 
                    x-data="{ type: '{{ item.item_type|default:'MC' }}' }" 
                    x-model="type" 
                    @change="$dispatch('type-change', type)">
                {% for code, name in item_types %}
                    <option value="{{ code }}" {% if item.item_type == code %}selected{% endif %}>{{ name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Dificultad</label>
            <select name="difficulty" class="w-full rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                <option value="1" {% if item.difficulty == 1 %}selected{% endif %}>Fácil</option>
                <option value="2" {% if item.difficulty == 2 or not item %}selected{% endif %}>Media</option>
                <option value="3" {% if item.difficulty == 3 %}selected{% endif %}>Difícil</option>
            </select>
        </div>
    </div>

    <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Enunciado (Pregunta)</label>
        <textarea name="stem" rows="3" class="w-full rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" required placeholder="Ej: ¿Cuál es la capital de Francia?">{{ item.stem }}</textarea>
    </div>

    <div x-data="{ show: '{{ item.item_type|default:'MC' }}' === 'MC' }" 
         x-show="show" 
         @type-change.window="show = ($event.detail === 'MC')"
         class="space-y-3 bg-gray-50 p-4 rounded-lg border border-gray-200 transition-all">
        
        <div>
            <label class="block text-sm font-medium text-green-700 mb-1">Respuesta Correcta</label>
            <input type="text" name="correct_answer" value="{{ correct_answer_text }}" class="w-full rounded-md border border-green-300 p-2 focus:border-green-500 focus:ring-1 focus:ring-green-500" placeholder="La respuesta correcta aquí...">
        </div>

        <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Distractores (Opciones incorrectas)</label>
            {% for dist in distractors_list %}
                <input type="text" name="distractors" value="{{ dist }}" class="w-full rounded-md border border-gray-300 p-2 focus:border-red-300 focus:ring-1 focus:ring-red-300 text-sm" placeholder="Opción incorrecta...">
            {% endfor %}
        </div>
        
        <div class="flex justify-end mt-2">
            <button type="button" 
                    hx-post="{% url 'backoffice:ai_generate_distractors' %}"
                    hx-target="#modal-content-form"
                    hx-include="[name='stem'], [name='correct_answer']"
                    class="text-xs font-semibold bg-purple-100 text-purple-700 px-3 py-1.5 rounded-full hover:bg-purple-200 transition-colors flex items-center gap-1 border border-purple-200 shadow-sm">
                <span>✨</span> Generar Distractores con IA
            </button>
        </div>
    </div>

    <div>
        <label class="block text-sm font-medium text-gray-500 mb-1">
            Etiquetas <span class="text-xs text-gray-400 font-normal">(Opcional, separadas por coma)</span>
        </label>
        <input type="text" 
               name="tags" 
               value="{{ item.tags|default:'' }}" 
               class="w-full rounded-md border border-gray-300 p-2 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500" 
               placeholder="Ej: Historia, Unidad 1, Parcial 2024">
    </div>
    <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100 mt-4">
        <button type="button" @click="modalOpen = false" class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
            Cancelar
        </button>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 shadow-sm transition-colors">
            {% if item %}Guardar Cambios{% else %}Crear Pregunta{% endif %}
        </button>
    </div>
</form>
